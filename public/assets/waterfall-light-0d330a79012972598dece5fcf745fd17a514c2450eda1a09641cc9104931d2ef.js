/**
 * Copyright 2015, Zap Lin
 * All rights reserved.
 *
 * This source code is licensed under the Apache license found in the
 * LICENSE file in the root directory of this source tree.
 */
!function(e){function t(e,t){for(var n=a[e].top,r=0,i=n[r],o=0;o<n.length;o++)t?n[o]>i&&(i=n[o],r=o):n[o]<i&&(i=n[o],r=o);return r}function n(n){var r=o(n),i=a[r].gridWidth,s=a[r].w,u=a[r].gap,l=a[r].scrollbottom;a[r].col=1,a[r].top=[];for(var c=i.length-1;c>=0;c--)if(s>i[c]){a[r].col=c+1;break}for(var f=(s-(a[r].col-1)*u)/a[r].col,d=[],p=0;p<a[r].col;p++)d.push(p*f+p*u),a[r].top.push(0);n.children().css({position:"absolute",left:s/2-f/2+"px",top:n.scrollTop(),transition:"left "+a[r].refresh+"ms ease-in-out,top "+a[r].refresh+"ms ease-in-out,opacity "+a[r].refresh+"ms ease-in-out"}).each(function(){var n=t(r,!1);e(this).css({width:f+"px",left:d[n]+"px",top:a[r].top[n]+"px",opacity:"1"}),a[r].top[n]+=e(this)[0].offsetHeight+u}),n.css("height",a[r].top[t(r,!0)]+"px"),l&&l.endele&&l.endele.addClass("endele").text(l.endtxt).css("top",a[r].top[t(r,!0)]+"px")}function r(e){var t=o(e);a[t].timer||(a[t].timer=setInterval(function(){var r=e[0].offsetWidth;a[t].w!==r&&(a[t].w=r,n(e)),a[t].scrollbottom&&a[t].scrollbottom.callback&&i(a[t].scrollbottom.ele,a[t].scrollbottom.gap)&&a[t].scrollbottom.callback(e)},a[t].refresh)),n(e)}function i(t,n){var r=e(window).height();return r+t.scrollTop()>t.prop("scrollHeight")-n}function o(e){return e.attr("wf-id")||(s+=.1,e.attr("wf-id",s)),e.attr("wf-id")}var a={_init_:{top:!1,w:!1,col:!1,gap:10,gridWidth:[0,400,600,800,1200],refresh:500,timer:!1,scrollbottom:!1}},s=0,u={init:function(){var t=o(this);a[t]||(a[t]=e.extend({},a._init_)),arguments[0]&&(a[t]=e.extend(a[t],arguments[0])),a[t].scrollbottom&&(a[t].scrollbottom=e.extend({ele:this.parent(),endele:e("<div>").css({width:"100%",textAlign:"center",position:"absolute"}),endtxt:"No More Data",gap:300},a[t].scrollbottom)),this.css("position","relative"),r(this)},sort:function(){n(this)},stop:function(){var e=o(this);a[e].timer&&(clearInterval(a[e].timer),a[e].timer=!1)},end:function(){var e=o(this);a[e].scrollbottom&&(a[e].scrollbottom.ele.css("top",a[e].top[t(e,!0)]+"px"),this.append(a[e].scrollbottom.endele)),a[e].timer&&(clearInterval(a[e].timer),a[e].timer=!1)}};e.fn.waterfall=function(){var t;return arguments[0]&&"object"!=typeof arguments[0]?u[arguments[0]]?t=u[arguments[0]].apply(this,Array.prototype.slice.call(arguments[0],1)):e.error("Method "+arguments[0]+" does not exist on jQuery.waterfall"):t=u.init.apply(this,arguments),t||this}}(jQuery);