<script type="text/javascript"
     src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAJH73o0NByZaaslmz9wnJHHExqkDCf2TY&libraries=geometry">
  </script>
  
  <script type="text/javascript">

  var map = null;
  function initialize() {
    var mapOptions = {
      center: { lat: 37.551626, lng: 126.937641},
      zoom: 17
    }; 
    
    map = new google.maps.Map(document.getElementById('map-canvas'),mapOptions);
   //서강A(서강대 남문)
  var sogang_a = [
    {lat:37.547856, lng:126.941885},{lat:37.546631, lng:126.940732},{lat:37.547222, lng:126.937739},
    {lat:37.549774, lng:126.936365},{lat:37.549758, lng:126.937520},{lat:37.549687, lng:126.937893},
    {lat:37.549706, lng:126.938092},{lat:37.549815, lng:126.938444},{lat:37.549394, lng:126.938764},
    {lat:37.549177, lng:126.939053},{lat:37.547856, lng:126.941885}
    ];
    
  //이화A(이대 정문)
  var ewha_a = [ //이대 정문 구역 //신촌기차역에서 시작. 이대정문구역이랑 겹침
    {lat:37.559112, lng:126.942823},{lat:37.558547, lng:126.942733},//구역5, 공통구역이랑 만나는 꼭지점
    {lat:37.556677, lng:126.942861},{lat:37.556880, lng:126.946686},
    {lat:37.558752, lng:126.946537},{lat:37.559181, lng:126.946352},
    {lat:37.559162, lng:126.945679},{lat:37.559112, lng:126.942823}
    ];
  
  //이화B(신촌기차역)
  var ewha_yonsei_b = [
    {lat:37.558557, lng:126.942693},{lat:37.559081, lng:126.942178},{lat:37.559053, lng:126.939687},{lat:37.559004, lng:126.939428},
    {lat:37.557559, lng:126.937469},{lat:37.556957, lng:126.937513},{lat:37.555946, lng:126.937495},{lat:37.555901, lng:126.937583},
    {lat:37.555460, lng:126.937813},{lat:37.556551, lng:126.941061},{lat:37.556686, lng:126.942824},{lat:37.558557, lng:126.942693}
    ];
    
    
  //이화-연세D(이대후문/연대동문)
  var ewha_yonsei_d = [             
    {lat:37.566943, lng:126.946975},{lat:37.566913, lng:126.947406},{lat:37.566832, lng:126.947586},
    {lat:37.567125, lng:126.947889},{lat:37.566981, lng:126.948396},{lat:37.567104, lng:126.948498},
    {lat:37.567276, lng:126.948916},{lat:37.567393, lng:126.948882},{lat:37.567601, lng:126.948954},
    {lat:37.567733, lng:126.949420},{lat:37.568013, lng:126.949434},{lat:37.568188, lng:126.949329},
    {lat:37.568298, lng:126.949150},{lat:37.569115, lng:126.948040},{lat:37.569301, lng:126.947577},
    {lat:37.569189, lng:126.946146},{lat:37.569062, lng:126.945272},{lat:37.569065, lng:126.944933},
    {lat:37.568970, lng:126.944677},{lat:37.568506, lng:126.944824},{lat:37.568007, lng:126.945011},
    {lat:37.567569, lng:126.945156},{lat:37.567115, lng:126.945471},{lat:37.566486, lng:126.945841},
    {lat:37.566542, lng:126.946132},{lat:37.566943, lng:126.946975}
    ];
    
  //연세A(연대 정문) (B는 겹치는 구역)
  var yonsei_a = [  //명물길 예림고시원 앞에서 시작
    {lat:37.559068, lng:126.939704},{lat:37.559282, lng:126.939681},{lat:37.559358, lng:126.936327},
    {lat:37.559218, lng:126.934372},{lat:37.558977, lng:126.933753},{lat:37.558377, lng:126.932946},
    {lat:37.557389, lng:126.932107},{lat:37.556987, lng:126.931930},{lat:37.555306, lng:126.936883},
    {lat:37.555458, lng:126.937795},{lat:37.555890, lng:126.937567},{lat:37.555941, lng:126.937473},
    {lat:37.556957, lng:126.937492},{lat:37.557570, lng:126.937447},{lat:37.559014, lng:126.939414},
    {lat:37.559068, lng:126.939704}
    ];
     
  //연세C(연대 남문) 
  var yonsei_c = [ 
    {lat:37.559229, lng:126.934336},{lat:37.559830, lng:126.934185},{lat:37.562716, lng:126.931055},{lat:37.564505, lng:126.929139},//연희교차로
    {lat:37.560915, lng:126.926766},{lat:37.559668, lng:126.926766},{lat:37.559598, lng:126.927887},
    {lat:37.559265, lng:126.928693},{lat:37.559191, lng:126.929309},{lat:37.558960, lng:126.929542},
    {lat:37.558817, lng:126.930105},{lat:37.557610, lng:126.931322},{lat:37.557426, lng:126.932094},//연대 정문구역과 만나는 지점  
    {lat:37.558419, lng:126.932926},{lat:37.559018, lng:126.933782},{lat:37.559229, lng:126.934336}
    ];
    
  //연세E(연대 서문)  
  var yonsei_e = [
    {lat:37.564575, lng:126.929218},{lat:37.569033, lng:126.932693},{lat:37.567914, lng:126.934999},
    {lat:37.567919, lng:126.935547},{lat:37.567540, lng:126.935828},{lat:37.566556, lng:126.935190},
    {lat:37.566350, lng:126.934866},{lat:37.566198, lng:126.934404},{lat:37.563799, lng:126.933859},
    {lat:37.563453, lng:126.933630},{lat:37.563158, lng:126.932769},{lat:37.563256, lng:126.932042},
    {lat:37.562751, lng:126.931375},{lat:37.564575, lng:126.929218}
    ];
    

  //서강a(서강대 남문)
  var sogang_a = new google.maps.Polygon({
    paths: sogang_a,
    //strokeColor: '#594F4F',
    strokeOpacity: 0.3,
    strokeWeight: 1,
    fillColor: '#F75D59',
    fillOpacity: 0.3
  });

  //이화a(이대 정문)
  var ewha_a = new google.maps.Polygon({
    paths: ewha_a,
    //strokeColor: '#594F4F',
    strokeOpacity: 0.3,
    strokeWeight: 1,
    fillColor: '#F87217',
    fillOpacity: 0.3
  });

   //이화-연세B(신촌기차역)
  var ewha_yonsei_b = new google.maps.Polygon({
    paths: ewha_yonsei_b,
    //strokeColor: '#594F4F',
    strokeOpacity: 0.3,
    strokeWeight: 1,
    fillColor: '#7FE817',
    fillOpacity: 0.3
  });

  //이화-연세D(이대 후문)
   var ewha_yonsei_d = new google.maps.Polygon({
    paths: ewha_yonsei_d,
    //strokeColor: '#594F4F',
    strokeOpacity: 0.3,
    strokeWeight: 1,
    fillColor: '#4FD1D1',
    fillOpacity: 0.3
  });

  //연세A(연대 정문)
   var yonsei_a = new google.maps.Polygon({
    paths: yonsei_a,
    //strokeColor: '#594F4F',
    strokeOpacity: 0.3,
    strokeWeight: 1,
    fillColor: '#B51414',
    fillOpacity: 0.2
   });

  //연세C(연대 남문) 
 var yonsei_c = new google.maps.Polygon({
    paths: yonsei_c,
    //strokeColor: '#594F4F',
    strokeOpacity: 0.3,
    strokeWeight: 1,
    fillColor: '#FFFF00',
    fillOpacity: 0.2
  });

  //연세E(연대 서문) 
 var yonsei_e = new google.maps.Polygon({
    paths: yonsei_e,
    //strokeColor: '#594F4F',
    strokeOpacity: 0.3,
    strokeWeight: 1,
    fillColor: '#1414B4',
    fillOpacity: 0.2
  });
  
  
    var geocoder = new google.maps.Geocoder();

    document.getElementById('mapfind').addEventListener('click', function() {
      geocodeAddress(geocoder, map);
    });
        
    function geocodeAddress(geocoder, resultsMap) {
      var address = document.getElementById('hasuk_house_address').value;
      geocoder.geocode({'address': address}, function(results, status) {
          
        if (status === google.maps.GeocoderStatus.OK) {
          resultsMap.setCenter(results[0].geometry.location);
          var marker = new google.maps.Marker({
            map: resultsMap,
            position: results[0].geometry.location
          });
                //여기서 results[0].geometry.location에 위도 경도가 (위도, 경도) 형식으로 저장된다.
                //results[0].geometry.location을 위도 경도 값에 각각 저장할 수 있도록 만들면 굿?
                
             
          var latitude = results[0].geometry.location.lat();
          var longitude = results[0].geometry.location.lng();
          var latlngmer = results[0].geometry.location;           
                  
          $(document).ready(function(){
            $("#mapfindcheck").click(function(){
              $.ajax({
                url: "/hasuk_houses/new",
                data: { latitude, longitude },
                success: function(data){
                  var latlng= new google.maps.LatLng(latitude, longitude);
                  if (google.maps.geometry.poly.containsLocation(latlng, sogang_a) == true ) {
                    division = "남문(대흥역)";
                    $("#hasuk_house_division").val(division);
                    
                  } else if (google.maps.geometry.poly.containsLocation(latlng, ewha_a) == true) {
                    division = "정문(이대역)";
                    $("#hasuk_house_division").val(division);
                    
                  } else if (google.maps.geometry.poly.containsLocation(latlng, ewha_yonsei_b) == true) {
                    division = "신촌기차역";
                    $("#hasuk_house_division").val(division);
                    
                  } else if (google.maps.geometry.poly.containsLocation(latlng, ewha_yonsei_d) == true) {
                    division = "이대후문";
                    $("#hasuk_house_division").val(division);
                    
                  } else if (google.maps.geometry.poly.containsLocation(latlng, yonsei_a) == true) {
                    division = "정문(신촌역)";
                    $("#hasuk_house_division").val(division);
                    
                  } else if (google.maps.geometry.poly.containsLocation(latlng, yonsei_c) == true) {
                    division = "연대남문";
                    $("#hasuk_house_division").val(division);
                    
                  } else if (google.maps.geometry.poly.containsLocation(latlng, yonsei_e) == true) {
                    division = "연대서문";
                    $("#hasuk_house_division").val(division);
                  }
                  $("#hasuk_house_lat").val(latitude);
                  $("#hasuk_house_lng").val(longitude);
                  alert("확인되었습니다.");
                }
              });
            });
            
          });
                    
        } else {
            alert('올바르지 않은 주소입니다');
          }
            
      });
    } //geocode function 종료

  }//function 마무리
  google.maps.event.addDomListener(window, 'load', initialize);
  
   
</script>
<%= render 'form' %>

